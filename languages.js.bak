const translations = {
    'en': {
        // Header
        'title': 'JPG/PNG to WebP Converter',
        
        // Upload Area
        'drag_drop': 'Drag and drop your image here or',
        'browse': 'browse',
        
        // Controls
        'convert_to': 'Convert to:',
        'quality': 'Quality:',
        'convert_all': 'Convert All',
        
        // Preview Area
        'original': 'Original',
        'converted': 'Converted',
        
        // Conversion status messages
        'converting': 'Converting...',
        'converting_fallback': 'Converting with fallback...',
        'conversion_failed': 'Conversion failed',
        'converted_size': 'Converted ({0} KB)',
        'size_info': 'Size: {0} KB',
        'files_skipped': 'Some files were skipped. Only JPEG and PNG files are supported.',
        
        // Buttons
        'clear_all': 'Clear All',
        'download': 'Download',
        
        // Features Section
        'key_features': 'Key Features',
        'no_uploads': 'No Uploads to Server',
        'privacy_desc': 'Your images stay private. No data is sent to any server.',
        'local_processing': 'Local Processing',
        'local_desc': 'All processing is done locally in your browser.',
        'best_web': 'Best for Web',
        'web_desc': 'Optimized images perfectly suited for websites and web apps.',
        'removes_metadata': 'Removes Metadata',
        'metadata_desc': 'Automatically strips unnecessary metadata while converting.',
        'fast_conversion': 'Fast Conversion',
        'fast_desc': 'Performant and lightning-fast conversion process.',
        'top_performance': 'Top Performance',
        'performance_desc': 'Best-in-class performance for local image converters.',
        'batch_processing': 'Batch Processing',
        'batch_desc': 'Convert multiple images at once with bulk processing.',
        'size_reduction': 'Size Reduction',
        'size_desc': 'Significantly reduces file size while maintaining quality.',
        
        // Reviews Section
        'user_reviews': 'User Reviews',
        
        // FAQ Section
        'faq': 'Frequently Asked Questions',
        'faq1_q': 'What image formats can I convert to WebP?',
        'faq1_a': 'This tool is specifically designed to convert JPG/JPEG and PNG images to WebP format. Other formats are not supported at this time.',
        'faq2_q': 'Is my data secure when using this tool?',
        'faq2_a': 'Absolutely! All processing is done locally in your browser. Your images never leave your device, and no data is sent to any server, ensuring complete privacy and security.',
        'faq3_q': 'What is WebP and why should I use it?',
        'faq3_a': 'WebP is a modern image format developed by Google that provides superior lossless and lossy compression for web images. WebP images are typically 25-35% smaller than comparable JPEG or PNG files while maintaining similar visual quality, resulting in faster website loading times and reduced bandwidth usage.',
        'faq4_q': 'What quality setting should I use?',
        'faq4_a': 'For most web usage, a quality setting between 70-85% offers the best balance between file size and image quality. Lower values (below 70%) will produce smaller files but may show more compression artifacts. Higher values (above 85%) will maintain higher quality but with diminishing returns on file size reduction.',
        'faq5_q': 'Is there a limit to how many images I can convert at once?',
        'faq5_a': 'There\'s no fixed limit, but performance depends on your device\'s capabilities. For optimal performance, we recommend converting batches of 20-30 images at a time. Larger batches may cause your browser to slow down.',
        'faq6_q': 'Are WebP images supported in all browsers?',
        'faq6_a': 'WebP is now supported in all major modern browsers including Chrome, Firefox, Edge, Safari, and Opera. However, older browser versions might not support WebP. For websites, it\'s recommended to provide fallback formats using the picture element.',
        
        // Footer
        'email': 'Email:'
    },
    'es': {
        // Header
        'title': 'Conversor de JPG/PNG a WebP',
        
        // Upload Area
        'drag_drop': 'Arrastra y suelta tu imagen aquí o',
        'browse': 'examinar',
        
        // Controls
        'convert_to': 'Convertir a:',
        'quality': 'Calidad:',
        'convert_all': 'Convertir Todo',
        
        // Preview Area
        'original': 'Original',
        'converted': 'Convertido',
        
        // Conversion status messages
        'converting': 'Convirtiendo...',
        'converting_fallback': 'Convirtiendo con método alternativo...',
        'conversion_failed': 'Conversión fallida',
        'converted_size': 'Convertido ({0} KB)',
        'size_info': 'Tamaño: {0} KB',
        'files_skipped': 'Se omitieron algunos archivos. Solo se admiten archivos JPEG y PNG.',
        
        // Buttons
        'clear_all': 'Borrar Todo',
        'download': 'Descargar',
        
        // Features Section
        'key_features': 'Características Principales',
        'no_uploads': 'Sin Cargas al Servidor',
        'privacy_desc': 'Tus imágenes permanecen privadas. No se envían datos a ningún servidor.',
        'local_processing': 'Procesamiento Local',
        'local_desc': 'Todo el procesamiento se realiza localmente en tu navegador.',
        'best_web': 'Ideal para Web',
        'web_desc': 'Imágenes optimizadas perfectamente adecuadas para sitios web y aplicaciones web.',
        'removes_metadata': 'Elimina Metadatos',
        'metadata_desc': 'Elimina automáticamente los metadatos innecesarios durante la conversión.',
        'fast_conversion': 'Conversión Rápida',
        'fast_desc': 'Proceso de conversión eficiente y ultrarrápido.',
        'top_performance': 'Máximo Rendimiento',
        'performance_desc': 'El mejor rendimiento para conversores de imágenes locales.',
        'batch_processing': 'Procesamiento por Lotes',
        'batch_desc': 'Convierte múltiples imágenes a la vez con procesamiento masivo.',
        'size_reduction': 'Reducción de Tamaño',
        'size_desc': 'Reduce significativamente el tamaño del archivo manteniendo la calidad.',
        
        // Reviews Section
        'user_reviews': 'Opiniones de Usuarios',
        
        // FAQ Section
        'faq': 'Preguntas Frecuentes',
        'faq1_q': '¿Qué formatos de imagen puedo convertir a WebP?',
        'faq1_a': 'Esta herramienta está diseñada específicamente para convertir imágenes JPG/JPEG y PNG al formato WebP. Otros formatos no son compatibles por el momento.',
        'faq2_q': '¿Están seguros mis datos al usar esta herramienta?',
        'faq2_a': '¡Absolutamente! Todo el procesamiento se realiza localmente en tu navegador. Tus imágenes nunca salen de tu dispositivo y no se envían datos a ningún servidor, lo que garantiza total privacidad y seguridad.',
        'faq3_q': '¿Qué es WebP y por qué debería usarlo?',
        'faq3_a': 'WebP es un formato de imagen moderno desarrollado por Google que proporciona una compresión superior, con o sin pérdida, para imágenes web. Las imágenes WebP son típicamente un 25-35% más pequeñas que los archivos JPEG o PNG comparables, manteniendo una calidad visual similar, lo que resulta en tiempos de carga de sitios web más rápidos y un menor uso de ancho de banda.',
        'faq4_q': '¿Qué configuración de calidad debería usar?',
        'faq4_a': 'Para la mayoría de los usos web, una configuración de calidad entre 70-85% ofrece el mejor equilibrio entre tamaño de archivo y calidad de imagen. Valores más bajos (por debajo del 70%) producirán archivos más pequeños pero pueden mostrar más artefactos de compresión. Valores más altos (por encima del 85%) mantendrán una mayor calidad pero con rendimientos decrecientes en la reducción del tamaño del archivo.',
        'faq5_q': '¿Hay un límite de cuántas imágenes puedo convertir a la vez?',
        'faq5_a': 'No hay un límite fijo, pero el rendimiento depende de las capacidades de tu dispositivo. Para un rendimiento óptimo, recomendamos convertir lotes de 20-30 imágenes a la vez. Lotes más grandes pueden hacer que tu navegador se ralentice.',
        'faq6_q': '¿Las imágenes WebP son compatibles con todos los navegadores?',
        'faq6_a': 'WebP ahora es compatible con todos los principales navegadores modernos, incluyendo Chrome, Firefox, Edge, Safari y Opera. Sin embargo, las versiones más antiguas de navegadores podrían no admitir WebP. Para sitios web, se recomienda proporcionar formatos alternativos utilizando el elemento picture.',
        
        // Footer
        'email': 'Correo electrónico:'
    }
};

// 通用格式化字符串函数
function formatString(str, ...args) {
    return str.replace(/{(\d+)}/g, function(match, number) { 
        return typeof args[number] != 'undefined' ? args[number] : match;
    });
}

// Function to switch language
function setLanguage(language) {
    const elementsToTranslate = document.querySelectorAll('[data-i18n]');
    elementsToTranslate.forEach(element => {
        const translationKey = element.getAttribute('data-i18n');
        if (translations[language] && translations[language][translationKey]) {
            if (element.tagName === 'INPUT' && element.type === 'placeholder') {
                element.placeholder = translations[language][translationKey];
            } else {
                element.textContent = translations[language][translationKey];
            }
        }
    });
    
    // 更新页面标题
    const titleElement = document.querySelector('title');
    if (titleElement && titleElement.getAttribute('data-i18n-head')) {
        const titleKey = titleElement.getAttribute('data-i18n-head');
        if (translations[language] && translations[language][titleKey]) {
            // 添加 "- macOS Style" 到标题
            const styleText = language === 'en' ? '- macOS Style' : '- Estilo macOS';
            titleElement.textContent = `${translations[language][titleKey]} ${styleText}`;
        }
    }
    
    // 更新 meta description 标签
    const descTag = document.querySelector('meta[name="description"]');
    if (descTag) {
        if (language === 'es') {
            const esDesc = document.querySelector('meta[name="description:es"]');
            if (esDesc) {
                descTag.setAttribute('content', esDesc.getAttribute('content'));
            }
        } else {
            // 恢复英文描述
            descTag.setAttribute('content', 'Free online tool to convert JPG/PNG to WebP. Fast local processing, batch conversion, and quality control for optimized web images. No server uploads needed.');
        }
    }
    
    // Update lang attribute
    document.documentElement.lang = language;
    
    // 同时更新旧的和新的语言选择器
    // 旧的下拉框选择器
    const languageSelector = document.getElementById('language-selector');
    if (languageSelector) {
        languageSelector.value = language;
    }
    
    // 新的地球图标选择器
    const languageOptions = document.querySelectorAll('.language-option');
    languageOptions.forEach(option => {
        if (option.getAttribute('data-lang') === language) {
            option.classList.add('active');
        } else {
            option.classList.remove('active');
        }
    });
    
    // Save language preference
    localStorage.setItem('preferredLanguage', language);
    
    // Update the alternate links for SEO
    updateAlternateLinks(language);
    
    // Update og:locale for SEO
    const ogLocale = document.querySelector('meta[property="og:locale"]');
    if (ogLocale) {
        ogLocale.setAttribute('content', language === 'en' ? 'en_US' : 'es_ES');
    }
    
    // 更新转换状态相关动态文本
    updateDynamicTranslations(language);
}

// 更新动态创建的转换状态文本
function updateDynamicTranslations(language) {
    // 更新动态创建的元素的文本
    if (translations && translations[language]) {
        // 清除按钮
        const clearButton = document.querySelector('.clear-button');
        if (clearButton) {
            clearButton.textContent = translations[language].clear_all;
        }
        
        // 下载按钮
        const batchDownloadButton = document.querySelector('.batch-download-button');
        if (batchDownloadButton) {
            batchDownloadButton.textContent = translations[language].download;
        }
        
        // 转换状态文本
        document.querySelectorAll('.file-status').forEach(status => {
            const text = status.textContent;
            const loadingSpinner = status.querySelector('.loading-spinner');
            
            if (text.includes('Converting...') || text.includes('Convirtiendo...')) {
                status.innerHTML = '';
                if (loadingSpinner) status.appendChild(loadingSpinner);
                status.appendChild(document.createTextNode(translations[language].converting));
            } 
            else if (text.includes('Converting with fallback') || text.includes('Convirtiendo con método')) {
                status.innerHTML = '';
                if (loadingSpinner) status.appendChild(loadingSpinner);
                status.appendChild(document.createTextNode(translations[language].converting_fallback));
            }
            else if (text.includes('Conversion failed') || text.includes('Conversión fallida')) {
                status.textContent = translations[language].conversion_failed;
            }
            else if (text.match(/Converted \([\d.]+ KB\)/) || text.match(/Convertido \([\d.]+ KB\)/)) {
                const size = text.match(/\(([\d.]+) KB\)/);
                if (size) {
                    status.textContent = formatString(translations[language].converted_size, size[1]);
                }
            }
        });
        
        // 图片信息
        document.querySelectorAll('.image-info').forEach(info => {
            const text = info.textContent;
            const size = text.match(/Size: ([\d.]+) KB/) || text.match(/Tamaño: ([\d.]+) KB/);
            if (size) {
                info.textContent = formatString(translations[language].size_info, size[1]);
            }
        });
    }
}

// Function to update alternate links for SEO
function updateAlternateLinks(currentLang) {
    // Remove existing alternate links
    const existingLinks = document.querySelectorAll('link[rel="alternate"][hreflang]');
    existingLinks.forEach(link => link.remove());
    
    // Add new alternate links
    const languages = Object.keys(translations);
    const head = document.querySelector('head');
    
    // 添加x-default链接
    const defaultLink = document.createElement('link');
    defaultLink.rel = 'alternate';
    defaultLink.hreflang = 'x-default';
    const defaultUrl = new URL(window.location.href);
    defaultUrl.search = '';
    defaultLink.href = defaultUrl.toString();
    head.appendChild(defaultLink);
    
    languages.forEach(lang => {
        const link = document.createElement('link');
        link.rel = 'alternate';
        link.hreflang = lang;
        // Create URL with language parameter
        const url = new URL(window.location.href);
        url.searchParams.set('lang', lang);
        link.href = url.toString();
        head.appendChild(link);
    });
}

// Initialize language based on URL parameter, localStorage, or browser settings
function initializeLanguage() {
    // Check URL parameters first
    const urlParams = new URLSearchParams(window.location.search);
    let lang = urlParams.get('lang');
    
    // If no language in URL, check localStorage
    if (!lang || !translations[lang]) {
        lang = localStorage.getItem('preferredLanguage');
    }
    
    // If no language in localStorage, check browser settings
    if (!lang || !translations[lang]) {
        const browserLang = navigator.language.split('-')[0];
        lang = translations[browserLang] ? browserLang : 'en';
    }
    
    // Set the language
    setLanguage(lang);
}

// Event listener for language selector
document.addEventListener('DOMContentLoaded', function() {
    const languageSelector = document.getElementById('language-selector');
    if (languageSelector) {
        languageSelector.addEventListener('change', function() {
            setLanguage(this.value);
        });
    }
    
    // Initialize language
    initializeLanguage();
    
    // 修补window.alert，支持多语言
    if (window.alert) {
        const originalAlert = window.alert;
        window.alert = function(message) {
            const currentLang = document.documentElement.lang || 'en';
            
            if (message === 'Some files were skipped. Only JPEG and PNG files are supported.' ||
                message === 'Se omitieron algunos archivos. Solo se admiten archivos JPEG y PNG.') {
                originalAlert(translations[currentLang].files_skipped);
            } else {
                originalAlert(message);
            }
        };
    }
}); 